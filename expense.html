<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <title>Expense App</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"></script>
  </head>
  <body>
    <section class="container">
      <form id="my-form">
          <label for="expense" class="text-danger">Choose Expense Amount:</label>
          <input type="number" id="expense">
          <label for="description" class="text-danger">Choose Description:</label>
          <input type="text" id="description">
          <label for="category" class="text-danger">Choose a Category:</label>
          <select id="category">
            <option value="fuel">Fuel</option>
            <option value="movie">Movie</option>
            <option value="food">Food</option>
            <option value="electricity">Electricity</option>
          </select>
        <input class="btn btn-primary btn-sm" type="submit" value="Add Expense">
      </form>
      <ul id="listofexpense">
      </ul>
    </section>
    <script>
        const myForm = document.querySelector('#my-form');
        const expenseInput = document.querySelector('#expense');
        const descriptionInput = document.querySelector('#description');
        const categoryInput = document.querySelector('#category');
        const listOfExpense = document.querySelector('#listofexpense');
        
        
        myForm.addEventListener('submit', onSubmit);
           
        function onSubmit(e) {
        e.preventDefault();
        
            const li = document.createElement('li');
            const exp=expenseInput.value;
            const desc=descriptionInput.value;
            const cat=categoryInput.value;
            const inputData={
            exp,
            cat,
            desc
            };

            axios.post("http://localhost:3000/add-expense",inputData)
                  .then((response)=>{
                      // console.log(response);
                      showuser(response.data.newExpense);
                  })
                  .catch((err)=>{
                      console.log(err);
                  })

            expenseInput.value = '';
            descriptionInput.value='';
            categoryInput.value = '';
            
        }
        
        window.addEventListener("DOMContentLoaded",()=>{
        
        axios.get(`http://localhost:3000/get-expense`)
              .then((response)=>{
                  for(let i=0;i<response.data.allExpense.length;i++)
                  {
                      showuser(response.data.allExpense[i])
                  }
                  console.log(response);
              })
              .catch((err)=>{
                  console.error(err)
              });
      })

        function showuser(obj){
        const parentitem=document.getElementById("listofexpense");
        const childitem=document.createElement("li");
        childitem.textContent=obj.amount+ "-"+obj.description+"-"+obj.category;

        const deleteitem =document.createElement("input");
        deleteitem.className="btn btn-danger btn-sm";
        deleteitem.type="button";
        deleteitem.value="Delete Expense";
        
        
        const edititem =document.createElement("input");
        edititem.className="btn btn-warning btn-sm";
        edititem.type="button";
        edititem.value="Edit Expense";
        

        deleteitem.onclick=()=>{
          axios.delete(`http://localhost:3000/delete/${obj.id}`)
          .then((response)=>{
              console.log(response);
          })
          .catch((err)=>{
              console.log(err)
          });
            parentitem.removeChild(childitem);
        }
        edititem.onclick=()=>{
            axios.delete(`http://localhost:3000/edit/${obj.id}`)
            .then((response)=>{
                console.log(response);
            })
            .catch((err)=>{
                console.log(err)
            });
            parentitem.removeChild(childitem);
            document.getElementById("expense").value=obj.amount;
            document.getElementById("category").value=obj.category;
            document.getElementById("description").value=obj.description;
            
        }
        childitem.appendChild(deleteitem);
        childitem.appendChild(edititem);
        parentitem.appendChild(childitem);
        }
    </script>
     
  </body>
</html>